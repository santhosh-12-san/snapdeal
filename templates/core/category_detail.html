{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* =========================================================
       1. HEADER OVERRIDES (Specific to Category Page)
       Matches screenshot: Red Header, White Text, White Search
       ========================================================= */
    
    /* Make the Main Header Background RED */
    .sd-header-main { 
        background-color: #e40046 !important; 
        padding-top: 15px; 
        padding-bottom: 15px; 
    }
    
    /* Make the Top Bar DARK RED */
    .sd-top-bar { 
        background-color: #c7003d !important; 
    }

    /* Force all Header Text & Icons to WHITE */
    .sd-logo-text { color: white !important; }
    .sc-49edc83e-5 { color: white !important; } /* Sign In Text */
    .far, .fas { color: white !important; } /* All Icons */
    #headerCartLink { color: white !important; }
    
    /* Fix Search Bar: White Box, Black Button */
    .sc-49edc83e-7 { background: white !important; } /* Input container white */
    .sc-49edc83e-8 { background: #333 !important; } /* Search Button Black */
    .search-box-input { background: white !important; }
    
    /* Hide the white category strip on this page (Snapdeal does this) */
    .sd-category-bar { display: none !important; } 

    /* =========================================================
       2. PAGE LAYOUT & SIDEBAR
       ========================================================= */
    body { background-color: #f7f7f7; font-family: 'Roboto', sans-serif; }

    .cat-container {
        display: flex;
        max-width: 1300px;
        margin: 0 auto;
        padding: 20px 10px;
        gap: 15px;
    }

    .sd-sidebar {
        width: 235px;
        flex-shrink: 0;
        background: white;
        border-radius: 3px;
        box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        padding: 10px 15px;
        height: fit-content;
        align-self: flex-start;
    }

    /* Filter Headers */
    .filter-title {
        font-size: 13px;
        font-weight: 600;
        color: #555;
        margin-bottom: 10px;
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
    }
    .filter-title:first-child { margin-top: 0; }

    /* Category Tree */
    .cat-tree-list { list-style: none; padding: 0; margin: 0; }
    .cat-tree-list li { margin-bottom: 5px; font-size: 12px; color: #666; }
    .cat-tree-list li.active { color: #e40046; font-weight: bold; }
    .cat-tree-list .count { color: #999; font-size: 11px; margin-left: 3px; }

    /* Price Filter (Inputs + Go) */
    .price-slider-visual {
        height: 4px; background: #ddd; position: relative; margin: 15px 5px;
    }
    .price-slider-visual::after {
        content: ''; position: absolute; left: 0; width: 40%; height: 100%; background: #999;
    }
    .price-slider-visual::before {
        content: ''; position: absolute; left: 40%; width: 12px; height: 12px; background: white; border: 2px solid #999; border-radius: 50%; top: -4px;
    }

    .price-row { display: flex; align-items: center; gap: 5px; margin-bottom: 20px; }
    .price-input { 
        width: 50px; padding: 4px; font-size: 11px; text-align: center; border: 1px solid #ccc; color: #333;
    }
    .btn-go { 
        padding: 3px 8px; font-size: 11px; background: white; border: 1px solid #ccc; color: #333; font-weight: bold; cursor: pointer;
    }
    .btn-go:hover { background: #333; color: white; }

    /* Checkbox Lists (Brand, Discount) */
    .search-brand {
        width: 100%; border: 1px solid #ddd; padding: 5px; font-size: 11px; margin-bottom: 10px; outline: none;
    }
    .check-list { list-style: none; padding: 0; margin: 0; max-height: 160px; overflow-y: auto; }
    .check-list li { display: flex; align-items: center; font-size: 11px; color: #555; margin-bottom: 6px; }
    .check-list input { margin-right: 8px; }
    .check-list::-webkit-scrollbar { width: 3px; }
    .check-list::-webkit-scrollbar-thumb { background: #ccc; }

    /* Color Swatches */
    .color-grid { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
    .color-swatch { width: 22px; height: 22px; border: 1px solid #ddd; cursor: pointer; }
    .color-swatch:hover { border-color: #333; box-shadow: 0 0 2px rgba(0,0,0,0.2); }

    /* =========================================================
       3. RIGHT CONTENT AREA
       ========================================================= */
    .sd-content { flex-grow: 1; }

    /* Title & Sort Bar */
    .cat-header-strip {
        background: white; padding: 15px 20px; border-bottom: 1px solid #e0e0e0;
        display: flex; justify-content: space-between; align-items: center;
        border-radius: 3px 3px 0 0;
    }
    .cat-main-title { font-size: 20px; color: #333; font-weight: 400; margin: 0; }
    .cat-item-count { font-size: 12px; color: #999; margin-left: 8px; }
    
    .cat-search-input {
        border: none; border-bottom: 1px solid #ccc; padding: 5px; font-size: 12px; width: 220px; margin-left: 20px; outline: none;
    }

    .sort-container { display: flex; align-items: center; gap: 10px; font-size: 12px; color: #666; }
    .sort-select { border: 1px solid #e0e0e0; padding: 5px; font-size: 11px; color: #333; background: #fff; cursor: pointer; }

    /* APPLIED FILTERS (The Chips from Screenshot) */
    .filter-bar {
        background: white; padding: 10px 20px; border-bottom: 1px solid #e0e0e0;
        display: flex; align-items: center; gap: 10px; flex-wrap: wrap;
    }
    .filter-label { font-size: 12px; color: #999; margin-right: 5px; }
    .filter-chip {
        background: white; border: 1px solid #ddd; padding: 4px 10px;
        font-size: 11px; color: #666; display: flex; align-items: center; gap: 6px;
        cursor: pointer;
    }
    .filter-chip:hover { border-color: #999; }
    .filter-chip i { font-size: 10px; color: #aaa; }
    .clear-all-btn { 
        font-size: 11px; color: #333; font-weight: bold; border: 1px solid #ddd; 
        padding: 4px 10px; text-decoration: none; cursor: pointer; 
    }

    /* PRODUCT GRID */
    .product-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr); /* Exactly 4 columns */
        gap: 15px;
        margin-top: 15px;
    }

    .sd-card {
        background: white;
        padding: 10px;
        border-radius: 2px;
        transition: box-shadow 0.2s;
        border: 1px solid transparent;
        position: relative;
    }
    .sd-card:hover {
        box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        border-color: #f0f0f0;
        z-index: 5;
    }

    .card-img-container {
        height: 240px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 10px;
        overflow: hidden;
        position: relative;
    }
    .card-img-container img {
        max-height: 100%; max-width: 100%; transition: transform 0.3s ease;
    }
    .sd-card:hover .card-img-container img { transform: scale(1.05); }

    /* Quick View Button */
    .quick-view {
        position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
        background: rgba(255,255,255,0.9); border: 1px solid #ddd;
        color: #333; font-size: 10px; font-weight: bold;
        padding: 6px 12px; display: none; white-space: nowrap;
    }
    .sd-card:hover .quick-view { display: block; }

    .card-title {
        font-size: 12px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 5px;
    }
    .price-block { display: flex; align-items: center; gap: 8px; }
    .price-final { font-size: 14px; font-weight: bold; color: #333; }
    .price-old { font-size: 12px; text-decoration: line-through; color: #999; }
    .price-off { font-size: 10px; color: #999; border: 1px solid #ccc; padding: 0 4px; border-radius: 2px; }
    
    .rating-block { display: flex; align-items: center; margin-top: 4px; }
    .rating-block i { font-size: 10px; color: #ddd; }
    .rating-block i.filled { color: #ffb400; }
    .rating-count { font-size: 10px; color: #999; margin-left: 4px; }

    /* Responsive */
    @media (max-width: 1200px) { .product-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 768px) { 
        .sd-sidebar { display: none; } 
        .product-grid { grid-template-columns: repeat(2, 1fr); }
    }
</style>

<div class="bg-white border-bottom py-2" style="font-size: 11px; color: #999;">
    <div class="sd-container">
        Home / {{ category.name }}
    </div>
</div>

<div class="cat-container">
    
    <aside class="sd-sidebar">
        
        <div class="mb-4">
            <div class="filter-title">Footwear <i class="fas fa-minus small text-muted"></i></div>
            <ul class="cat-tree-list">
                <li class="active mb-2 text-danger">- {{ category.name }} <span class="count">({{ product_count }})</span></li>
                {% for child in category.children.all %}
                <li>
                    <a href="{% url 'core:category_detail' child.id %}" class="text-decoration-none text-muted">
                        {{ child.name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>

        <div class="mb-4 border-bottom pb-3">
            <div class="filter-title">Price <a href="#" class="text-danger small text-decoration-none" style="font-size: 10px;">CLEAR</a></div>
            <div class="price-slider-visual"></div>
            <form method="GET">
                <input type="hidden" name="sort" value="{{ request.GET.sort }}">
                <div class="price-row">
                    <span style="font-size: 11px; color: #666;">Rs.</span>
                    <input type="text" name="min_price" class="price-input" value="{{ request.GET.min_price }}" placeholder="Min">
                    <span style="font-size: 11px; color: #666;">to</span>
                    <input type="text" name="max_price" class="price-input" value="{{ request.GET.max_price }}" placeholder="Max">
                    <button type="submit" class="btn-go">GO</button>
                </div>
            </form>
        </div>

        <div class="mb-4 border-bottom pb-3">
            <div class="filter-title">Brand <i class="fas fa-minus small text-muted"></i></div>
            <input type="text" class="search-brand" placeholder="Search Brand">
            <ul class="check-list">
                <li><input type="checkbox"> Bersache <span class="count">(12)</span></li>
                <li><input type="checkbox"> Dashny <span class="count">(45)</span></li>
                <li><input type="checkbox"> Footloose <span class="count">(22)</span></li>
                <li><input type="checkbox"> FUSEOWL <span class="count">(8)</span></li>
                <li><input type="checkbox"> IKAGI <span class="count">(34)</span></li>
            </ul>
        </div>

        <div class="mb-4 border-bottom pb-3">
            <div class="filter-title">Color <i class="fas fa-minus small text-muted"></i></div>
            <div class="color-grid">
                <div class="color-swatch" style="background:#f5f5dc;" title="Beige"></div>
                <div class="color-swatch" style="background:#000;" title="Black"></div>
                <div class="color-swatch" style="background:#0000ff;" title="Blue"></div>
                <div class="color-swatch" style="background:#cd7f32;" title="Bronze"></div>
                <div class="color-swatch" style="background:#a52a2a;" title="Brown"></div>
                <div class="color-swatch" style="background:#808080;" title="Grey"></div>
            </div>
        </div>

        <div>
            <div class="filter-title">Discount <i class="fas fa-minus small text-muted"></i></div>
            <ul class="check-list">
                <li><input type="checkbox"> 10% and above</li>
                <li><input type="checkbox"> 20% and above</li>
                <li><input type="checkbox"> 30% and above</li>
                <li><input type="checkbox"> 50% and above</li>
            </ul>
        </div>

    </aside>

    <main class="sd-content">
        
        <div class="cat-header-strip">
            <div class="d-flex align-items-center">
                <h1 class="cat-main-title">{{ category.name }}</h1>
                <span class="cat-item-count">({{ product_count|default:"4142" }} Items)</span>
                
                <div class="position-relative">
                    <input type="text" class="cat-search-input" placeholder="Search within category">
                    <i class="fas fa-search text-muted position-absolute end-0 top-50 translate-middle-y" style="font-size: 11px;"></i>
                </div>
            </div>

            <div class="sort-container">
                <span>Sort by:</span>
                <form method="GET" id="sortForm">
                    <input type="hidden" name="min_price" value="{{ request.GET.min_price }}">
                    <input type="hidden" name="max_price" value="{{ request.GET.max_price }}">
                    
                    <select name="sort" class="sort-select" onchange="document.getElementById('sortForm').submit()">
                        <option value="popularity" {% if request.GET.sort == 'popularity' %}selected{% endif %}>Popularity</option>
                        <option value="price_low" {% if request.GET.sort == 'price_low' %}selected{% endif %}>Price Low To High</option>
                        <option value="price_high" {% if request.GET.sort == 'price_high' %}selected{% endif %}>Price High To Low</option>
                        <option value="new" {% if request.GET.sort == 'new' %}selected{% endif %}>Fresh Arrivals</option>
                    </select>
                </form>
            </div>
        </div>

        <div class="filter-bar">
            <div class="filter-label">Brand:</div>
            <div class="filter-chip">Bersache <i class="fas fa-times"></i></div>
            <div class="filter-chip">Dashny <i class="fas fa-times"></i></div>
            
            <div class="filter-label ms-3">Price:</div>
            <div class="filter-chip">Rs. 144 - Rs. 599 <i class="fas fa-times"></i></div>
            
            <a href="{% url 'core:category_detail' category.id %}" class="clear-all-btn ms-auto">CLEAR ALL</a>
        </div>

        <div class="product-grid">
            {% for product in products %}
            <a href="{% url 'core:product_detail' product.id %}" class="text-decoration-none text-dark">
                <div class="sd-card">
                    <div class="card-img-container">
                        {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}">
                        {% else %}
                            <div class="text-muted small">No Image</div>
                        {% endif %}
                        <div class="quick-view">QUICK VIEW</div>
                    </div>
                    
                    <div class="card-title">{{ product.name }}</div>
                    
                    <div class="price-block">
                        <span class="price-final">Rs. {{ product.selling_price }}</span>
                        {% if product.original_price > product.selling_price %}
                            <span class="price-old">Rs. {{ product.original_price }}</span>
                            <span class="price-off">{{ product.discount_percentage }}% Off</span>
                        {% endif %}
                    </div>

                    <div class="rating-block">
                        <i class="fas fa-star filled"></i>
                        <i class="fas fa-star filled"></i>
                        <i class="fas fa-star filled"></i>
                        <i class="fas fa-star filled"></i>
                        <i class="far fa-star"></i>
                        <span class="rating-count">(12)</span>
                    </div>
                </div>
            </a>
            {% empty %}
                <div class="col-12 py-5 text-center text-muted">
                    <h5>No products found.</h5>
                </div>
            {% endfor %}
        </div>

    </main>
</div>
{% endblock %}