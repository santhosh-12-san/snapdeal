{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-5" style="background-color: #f7f7f7; min-height: 80vh;">
    
    <div class="row">
        <div class="col-12 mb-3">
            <h4 class="fw-bold">Select Address (Step 2/3)</h4>
        </div>

        <div class="col-md-8">
            <form method="POST">
                {% csrf_token %}
                
                {% if addresses %}
                    {% for addr in addresses %}
                    <div class="card mb-3 shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex">
                                <div class="me-3 mt-1">
                                    <input class="form-check-input" type="radio" name="selected_address" value="{{ addr.id }}" id="addr_{{ addr.id }}" {% if forloop.first %}checked{% endif %}>
                                </div>
                                
                                <div class="w-100">
                                    <label class="form-check-label w-100" for="addr_{{ addr.id }}">
                                        <div class="d-flex justify-content-between">
                                            <span class="fw-bold">{{ addr.name }} <span class="badge bg-light text-dark border">{{ addr.address_type }}</span></span>
                                            <a href="{% url 'users:edit_address' addr.id %}" class="btn btn-sm btn-outline-secondary">Edit</a>
                                        </div>
                                        <p class="text-muted small mt-2 mb-1">
                                            {{ addr.address_line }}, {{ addr.locality }}<br>
                                            {{ addr.city }}, {{ addr.state }} - {{ addr.pincode }}
                                        </p>
                                        <p class="text-muted small mb-0">Mobile: <strong>{{ addr.mobile }}</strong></p>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                    <div class="text-end mt-4">
                       <a href="{% url 'orders:force_payment' %}" class="btn btn-danger px-5 py-2 fw-bold" style="background-color: #e40046;">
    PROCEED TO PAYMENT >
</a>
                    </div>

                {% else %}
                    <div class="alert alert-warning">No addresses found. Please add one.</div>
                {% endif %}
            </form>

            <div class="mt-3">
                <a href="{% url 'users:add_address' %}?next={% url 'users:select_address' %}" class="btn btn-outline-dark w-100 py-2 border-dashed">
                    + Add New Address
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}